<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8" />
        <title>StoryCraft Editor</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />

        <!-- Favicons -->
        <link href="assets/img/favicon.png" rel="icon" />
        <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

        <!-- Fonts -->
        <link href="https://fonts.googleapis.com" rel="preconnect" />
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet"
        />

        <!-- Vendor CSS Files -->
        <link
            href="assets/vendor/bootstrap/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
            rel="stylesheet"
        />
        <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
        <link
            href="assets/vendor/glightbox/css/glightbox.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/swiper/swiper-bundle.min.css"
            rel="stylesheet"
        />

        <!-- Main CSS File -->
        <link href="assets/css/main.css" rel="stylesheet" />
        <!-- Quill -->
        <link
            href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css"
            rel="stylesheet"
        />
        <style>
  :root {
    --bg: #f7f7fb;
    --card: #fff;
    --muted: #666;
    --border: #e5e7eb;
    --accent: #4f46e5; /* 주요 버튼 색 */
    --accent-2: #10b981;
    --text-strong: #1f2937;
  }

  html, body { height: 100%; }

  body {
    margin: 0;
    font-family: Inter, system-ui, AppleSDGothicNeo, Apple Color Emoji, Segoe UI Emoji, sans-serif;
    background: var(--bg);
  }

  /* ===== Layout ===== */
  .wrap{
    max-width:1500px;
    margin:40px auto;
    display:grid;
    grid-template-columns:1fr 320px;
    gap:16px;
    padding:0 20px;
  }
  @media (max-width: 1024px) {
    .wrap { grid-template-columns: 1fr; }
  }

  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
  }

  /* ===== Editor Card ===== */
  .editor-card {
    display: flex;
    flex-direction: column;
  }
  .toolbar { padding: 0; border: 0; }

  .editor { min-height: 520px; }
  #quill .ql-editor { padding: 14px 16px; }

  #resultArea:empty { display: none; }
  .spinner { display: none; font-size: 12px; color: #444; }

  .side {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  .side h3 { margin: 0 0 6px; font-size: 16px; }
  .panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
  }
  .panel + .panel { margin-top: 2px; }

  .panel-title {
    font-size: 12px;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: #8a8fa3;
    font-weight: 800;
    margin-bottom: 10px;
  }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .grid-1 { display: grid; grid-template-columns: 1fr; gap: 8px; }

  .sc-btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    height: 40px; padding: 0 14px;
    border-radius: 10px; border: 1px solid var(--border);
    font-weight: 700; letter-spacing: 0.2px;
    background: #fff; color: var(--text-strong);
    cursor: pointer; user-select: none;
    transition: box-shadow .15s ease, transform .02s ease, background .15s ease;
  }
  .sc-btn:hover { background: #f7f8fb; }
  .sc-btn:active { transform: translateY(1px); }
  .sc-btn:focus-visible {
    outline: 2px solid transparent;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.25);
  }
  .sc-btn--primary {
    background: var(--accent);
    color: #fff;
    border-color: transparent;
  }
  .sc-btn--primary:hover { filter: brightness(1.05); }
  .sc-btn--secondary { border-color: #d7daf0; background: #fff; }
  .sc-btn--secondary:hover { background: #f5f7ff; }

  .sc-select {
    height: 40px;
    padding: 0 38px 0 12px;
    border: 1.5px solid #d7daf0;
    border-radius: 10px;
    background: #fff;
    color: #111827;
    font-weight: 600;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='18' height='18' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 7l5 5 5-5' stroke='%238b90a5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 18px 18px;
  }
  .sc-select:hover { border-color: #bfc6ee; }
  .sc-select:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    border-color: var(--accent);
  }

  .row, .grid-2, .grid-1 { }
  .row > .sc-btn,
  .row > .sc-select,
  .grid-2 > .sc-btn,
  .grid-2 > .sc-select,
  .grid-1 > .sc-btn,
  .grid-1 > .sc-select { width: 100%; }

  .btn {
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: #fff;
    cursor: pointer;
    font-weight: 600;
  }
  .btn:hover { background: #fafafa; }


  .editor-card .footer { display: none !important; }


  .card.editor-card{
    border: 1px solid var(--border) !important;
    border-radius: 12px !important;
    box-shadow: 0 2px 12px rgba(0,0,0,.04);
    padding: 0 !important;
    overflow: hidden !important;
    background: var(--card);
  }

  /* 툴바+입력창*/
  .ql-frame{
    border: 0 !important;
    border-radius: 0 !important;
    margin: 0 !important;
  }

  /* 툴바 */
  #quill-toolbar.ql-toolbar.ql-snow{
    border: 0 !important;
    border-bottom: 1px solid var(--border) !important;
    border-radius: 0 !important;
    box-sizing: border-box;
    width: 100%;
    padding: 8px 10px;
    background: #fff;
  }


  #quill .ql-container.ql-snow{
    border: 0 !important;
    border-radius: 0 !important;
    box-sizing: border-box;
    width: 100%;
    background: #fff;
  }


  #quill .ql-editor{
    padding: 14px 16px;
    min-height: 520px;
  }


  @media (max-width:992px){ .wrap{ grid-template-columns:1fr; } }


  .wrap{
    display:grid;
    grid-template-columns:minmax(0,1fr) 320px;
    gap:16px;
    padding:20px;
  }


#quill-toolbar.ql-toolbar.ql-snow,
#quill .ql-container.ql-snow{
  border: 0 !important;
  outline: none !important;
  box-shadow: none !important;
}


#quill .ql-editor:focus{ outline: none !important; }


.card.editor-card{
  border: none !important;
  outline: 1px solid var(--border);
  outline-offset: -1px;  
  border-radius: 12px !important;
  overflow: hidden !important;
}



.ql-frame{ border: 0 !important; margin: 0 !important; border-radius: 0 !important; }


#quill-toolbar.ql-toolbar.ql-snow{ border-bottom: 1px solid var(--border) !important; }


.card.editor-card{
  border: 1px solid var(--border) !important;
  border-radius: 12px !important;
  overflow: hidden !important;
  padding: 0 !important;
  background: var(--card);
  outline: none !important;
  box-shadow: 0 2px 12px rgba(0,0,0,.04); 

}

.editor-card #quill-toolbar.ql-toolbar.ql-snow,
.editor-card #quill .ql-container.ql-snow{
  border: 0 !important;
  border-radius: 0 !important;
  outline: none !important;
  box-shadow: none !important;
}

.editor-card #quill-toolbar.ql-toolbar.ql-snow{
  border-bottom: 0 !important;
}

.editor-card .ql-toolbar.ql-snow,
#quill-toolbar.ql-toolbar.ql-snow,
.editor-card .ql-container.ql-snow,
#quill.ql-container.ql-snow,
#quill,                 
.editor {               
  border: 0 !important;
  outline: none !important;
  box-shadow: none !important;
}


#quill-toolbar.ql-toolbar.ql-snow { border-bottom: 0 !important; }

/* 바깥 카드 테두리 담당: 둥글게 */
.card.editor-card{
  border: 1px solid var(--border) !important;
  border-radius: 12px !important;
  overflow: hidden !important;
  padding: 0 !important;
  background: var(--card);
  box-shadow: 0 2px 12px rgba(0,0,0,.04);
}

/* 버튼 색깔 지정: 나중에 변경할 것 */
:root{
  --btn-summary:#3b82f6;  
  --btn-expand:#3b82f6;    
  --btn-honorific:#3b82f6;
  --btn-informal:#3b82f6;  
}

.sc-btn--summary{
  background:var(--btn-summary);
  color:#fff;
  border-color:transparent;
}
.sc-btn--summary:hover{ filter:brightness(1.06); }
.sc-btn--summary:focus-visible{ box-shadow:0 0 0 3px rgba(99,102,241,.28); }

.sc-btn--expand{
  background:var(--btn-expand);
  color:#fff;
  border-color:transparent;
}
.sc-btn--expand:hover{ filter:brightness(1.06); }
.sc-btn--expand:focus-visible{ box-shadow:0 0 0 3px rgba(16,185,129,.28); }

.sc-btn--rewrite{
  background:var(--btn-rewrite);
  color:#111827;
  border-color:transparent;
}
.sc-btn--rewrite:hover{ filter:brightness(1.05); }
.sc-btn--rewrite:focus-visible{ box-shadow:0 0 0 3px rgba(245,158,11,.28); }

.sc-btn--honorific{
  background:var(--btn-honorific);
  color:#fff;
  border-color:transparent;
}
.sc-btn--honorific:hover{ filter:brightness(1.06); }
.sc-btn--honorific:focus-visible{ box-shadow:0 0 0 3px rgba(59,130,246,.28); }

.sc-btn--informal{
  background:var(--btn-informal);
  color:#fff;
  border-color:transparent;
}
.sc-btn--informal:hover{ filter:brightness(1.06); }
.sc-btn--informal:focus-visible{ box-shadow:0 0 0 3px rgba(168,85,247,.28); }

/* 에디터 페이지 스피너 */
.edit_spinner{ position:fixed; inset:0; z-index:99999; display:none; }
.edit_spinner__backdrop{
  position:absolute; inset:0;
  background: rgba(17,24,39,.35); /*화면 어둡게 함 */
  backdrop-filter: blur(1.5px) saturate(85%);
}
.edit_spinner__center{
  position:absolute; top:50%; left:50%;
  transform: translate(-50%, -50%);
  display:flex; flex-direction:column; align-items:center; gap:12px;
}
.edit_spinner__ring{
  width:56px; height:56px; border-radius:50%;
  border:5px solid rgba(255,255,255,.35);
  border-top-color: var(--accent);   
  border-right-color: var(--accent);
  animation: edit_spinner_spin .9s linear infinite;
}
.edit_spinner__label{
  font-weight:700; color:#fff;
  text-shadow:0 1px 2px rgba(0,0,0,.35);
  font-size:14px;
}


.is-edit-loading{ overflow:hidden; }
.is-edit-loading .edit_spinner{ display:block; }

@keyframes edit_spinner_spin { to { transform: rotate(360deg); } }




</style>

    </head>
    <body class="index-page">
        <header id="header" class="header d-flex align-items-center sticky-top">
            <div
                class="container position-relative d-flex align-items-center justify-content-between"
            >
                <a
                    href="index.html"
                    class="logo d-flex align-items-center me-auto me-xl-0"
                >
                    <!-- Uncomment the line below if you also wish to use an image logo -->
                    <!-- <img src="assets/img/logo.png" alt=""> -->
                    <h1 class="sitename">StoryCraft</h1>
                </a>

                <nav id="navmenu" class="navmenu">
                    <ul>
                        <!-- <li>
                            <a href="index.html#hero" class="active">Home</a>
                        </li>
                        <li><a href="index.html#about">About</a></li>
                        <li><a href="index.html#services">Services</a></li> -->
                        <li><a href="search.html">Search</a></li>
                        <li><a href="rewrite.html">Rewrite</a></li>
                        <li><a href="change-style.html">Style</a></li>
                        <li><a href="grammar.html">Grammar</a></li>
                        <li><a href="honorific.html">Honorific</a></li>
                        <li><a href="translate.html">Translate</a></li>
                        <li><a href="scan.html">Scan</a></li>
                        <li><a href="image.html">Image Scan</a></li>
                        <li><a href="speech.html">Speech</a></li>
                        <li><a href="editor.html" class="active">Editor</a></li>
                    </ul>
                    <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
                </nav>
            </div>
        </header>
        <div class="wrap">
            <!-- 문서편집기 -->
            <div class="card editor-card">
                <div class="ql-frame">
                <div class="toolbar">
                    <div id="quill-toolbar">
                        <span class="ql-formats">
                            <select class="ql-header">
                                <option value="1"></option>
                                <option value="2"></option>
                                <option selected></option>
                            </select>
                            <select class="ql-font"></select>
                            <select class="ql-size"></select>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-bold"></button>
                            <button class="ql-italic"></button>
                            <button class="ql-underline"></button>
                            <button class="ql-strike"></button>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-list" value="ordered"></button>
                            <button class="ql-list" value="bullet"></button>
                            <select class="ql-align"></select>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-link"></button>
                            <button class="ql-blockquote"></button>
                            <button class="ql-code-block"></button>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-clean"></button>
                        </span>
                    </div>
                </div>
                <div id="quill" class="editor"></div>
                </div>
                <div class="footer">
                    <span id="spinner" class="spinner">⏳ 서버 처리 중…</span>
                </div>
                <div
                    id="resultArea"
                    class="card"
                    style="margin-top: 12px; padding: 12px"
                ></div>

                <!-- 공용 스크립트가 읽는 입력값(Quill↔공용 함수 연결용) -->
                <textarea id="userInput" style="display: none"></textarea>
                <input id="styleInput" type="hidden" />
                <input id="translateInput" type="hidden" />
            </div>

            <!-- 사이드 툴 패널 -->
            <div class="card side">
                <section class="panel">
                    <div class="panel-title">Translate & Import</div>
                    <div class="grid-2" style="margin-bottom: 8px">
                        <select
                            id="sourceSelector"
                            class="sc-select"
                            title="원본 언어"
                        >
                            <option value="auto" selected>자동 감지</option>
                            <option value="gu">구자라트어</option>
                            <option value="el">그리스어</option>
                            <option value="ne">네팔어</option>
                            <option value="nl">네덜란드어</option>
                            <option value="de">독일어</option>
                            <option value="ru">러시아어</option>
                            <option value="ro">루마니아어</option>
                            <option value="mr">마라티어</option>
                            <option value="ms">말레이어</option>
                            <option value="vi">베트남어</option>
                            <option value="bn">벵골어</option>
                            <option value="sv">스웨덴어</option>
                            <option value="es">스페인어</option>
                            <option value="af">아프리칸스어</option>
                            <option value="ar">아랍어</option>
                            <option value="en">영어</option>
                            <option value="uk">우크라이나어</option>
                            <option value="it">이탈리아어</option>
                            <option value="ja">일본어</option>
                            <option value="jv">자바어</option>
                            <option value="ka">조지아어</option>
                            <option value="zh-CN">중국어(간체)</option>
                            <option value="zh-TW">중국어(번체)</option>
                            <option value="ta">타밀어</option>
                            <option value="th">태국어</option>
                            <option value="tr">터키어</option>
                            <option value="fa">페르시아어</option>
                            <option value="pt">포르투갈어</option>
                            <option value="pl">폴란드어</option>
                            <option value="fr">프랑스어</option>
                            <option value="ko">한국어</option>
                            <option value="hi">힌디어</option>
                        </select>

                        <!-- 대상 언어 선택 -->
                        <select
                            id="targetSelector"
                            class="sc-select"
                            title="대상 언어"
                        >
                            <option value="gu">구자라트어</option>
                            <option value="el">그리스어</option>
                            <option value="ne">네팔어</option>
                            <option value="nl">네덜란드어</option>
                            <option value="de">독일어</option>
                            <option value="ru">러시아어</option>
                            <option value="ro">루마니아어</option>
                            <option value="mr">마라티어</option>
                            <option value="ms">말레이어</option>
                            <option value="vi">베트남어</option>
                            <option value="bn">벵골어</option>
                            <option value="sv">스웨덴어</option>
                            <option value="es">스페인어</option>
                            <option value="af">아프리칸스어</option>
                            <option value="ar">아랍어</option>
                            <option value="en" selected>영어</option>
                            <option value="uk">우크라이나어</option>
                            <option value="it">이탈리아어</option>
                            <option value="ja">일본어</option>
                            <option value="jv">자바어</option>
                            <option value="ka">조지아어</option>
                            <option value="zh-CN">중국어(간체)</option>
                            <option value="zh-TW">중국어(번체)</option>
                            <option value="ta">타밀어</option>
                            <option value="th">태국어</option>
                            <option value="tr">터키어</option>
                            <option value="fa">페르시아어</option>
                            <option value="pt">포르투갈어</option>
                            <option value="pl">폴란드어</option>
                            <option value="fr">프랑스어</option>
                            <option value="ko">한국어</option>
                            <option value="hi">힌디어</option>
                        </select>
                    </div>

                    <div class="grid-1">
                        <button
                            class="sc-btn sc-btn--primary"
                            id="btn-translate"
                        >
                            🌐 번역
                        </button>
                    </div>
                </section>

                <div class="hr"></div>

                <!-- 문체변경 -->
                <section class="panel">
                    <div class="panel-title">Style & Tone</div>
                    <div class="grid-2" style="margin-bottom: 8px">
                        <select
                            id="styleSelector"
                            class="sc-select"
                            title="문체 선택"
                        >
                            <option value="casual">구어체</option>
                            <option value="formal">격식체</option>
                            <option value="literary">문학체</option>
                            <option value="academic">학술체</option>
                        </select>
                        <button
                            class="sc-btn sc-btn--primary"
                            id="btn-style"
                            onclick="applyStyle()"
                        >
                            ✒️ 문체변경
                        </button>
                    </div>

                    <div class="grid-2">
                        <button class="sc-btn sc-btn--honorific" id="btn-honorific">🙇 높임말</button>

                        <button class="sc-btn sc-btn--informal" id="btn-informal">
                            🙂 반말
                        </button>
                    </div>
                </section>

                <div class="hr"></div>

                <!-- 첨삭/요약/확장 -->
                <section class="panel">
                    <div class="panel-title">Rewrite & Summary</div>
                    <div class="grid-2" style="margin-bottom: 8px">
                        <button
                            class="sc-btn sc-btn--summary"
                            id="btn-summary"
                        >
                            🧾 요약
                        </button>

                        <button class="sc-btn sc-btn--expand" id="btn-expand">➕ 확장</button>
                        
                    </div>
                    <div class="grid-1">
                        <button class="sc-btn sc-btn--primary"
                     id="btn-rewrite">🛠️ 첨삭</button>

                    </div>
                </section>
                <!-- 문법 교정 -->
                <section class="panel">
                    <div class="panel-title">Grammar</div>
                    <div class="grid-1">
                        <button
                            class="sc-btn sc-btn--primary"
                            id="btn-grammar"
                        >
                            ✔️ 문법 교정
                        </button>
                    </div>
                </section>

                <section class="panel sticky">
                    <div class="panel-title">Export</div>
                    <div class="grid-1">
                        <button
                            class="sc-btn sc-btn--secondary"
                            id="pdfDownloadBtn"
                        >
                            ⬇️ PDF로 저장
                        </button>
                    </div>
                </section>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
        <script>
            
            const BASE_URL = 'http://127.0.0.1:8000'; 
            const $editSpinner = document.getElementById('edit_spinner');

            
            const quill = new Quill('#quill', {
                modules: { toolbar: '#quill-toolbar' },
                theme: 'snow',
                placeholder: '여기에 문서를 작성하세요…',
            });

          
            function setEditorText(text) {
                
                quill.setText(text || '');
            }
            function getEditorText() {
                return quill.getText(); 
            }

            
            function showSpin(v) {
                
                document.documentElement.classList.toggle('is-edit-loading', !!v);

                const el = document.getElementById('edit_spinner');
                if (el) el.setAttribute('aria-hidden', String(!v));
    }



           
function getQuillSelectionOrAll() {

  const sel = quill.getSelection(true);
  if (sel && sel.length > 0) {
    const text = quill.getText(sel.index, sel.length);
    return {
      text,
      isAll: false,
      apply(out) {
        const attrs = quill.getFormat(sel.index, Math.max(sel.length, 1));
        quill.deleteText(sel.index, sel.length, 'user');
        quill.insertText(sel.index, out, attrs, 'user');
        quill.setSelection(sel.index + out.length, 0, 'silent');
      },
    };
  }

  const len = quill.getLength();
  const text = quill.getText(0, len);
  return {
    text,
    isAll: true,
    apply(out) { quill.setText(out); },
  };
}


['btn-rewrite','btn-summary','btn-expand','btn-style','btn-honorific','btn-informal','btn-translate','btn-grammar']
  .forEach(id=>{
    const b=document.getElementById(id);
    if(!b) return;
    b.addEventListener('mousedown', ()=>{ window.__lastQuillRange = quill.getSelection(true); });
  });
quill.on('selection-change', (range)=>{ window.__lastQuillRange = range; });


         
            async function postJSON(url, payload) {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });
                if (!res.ok) {
                    const t = await res.text();
                    throw new Error(`HTTP ${res.status} - ${t}`);
                }
                return res.json();
            }

            
            async function doRewrite() {
  const { text, apply } = getQuillSelectionOrAll();
  const content = (text || '').trim();
  if (!content) { alert('내용을 입력하세요.'); return; }

  showSpin(true);
  try {
    const data = await postJSON(`${BASE_URL}/mistralRewrite`, { content });
    const out =
      (data?.result ?? data?.text ?? data?.styled_text ?? data?.checked ?? data?.translated ?? '').trim();
    if (!out) throw new Error('빈 결과');
   
    apply(out);
  } catch (e) {
    alert('첨삭 실패: ' + e.message);
  } finally {
    showSpin(false);
  }
}

            async function doSummary() {
                const { text, apply } = getQuillSelectionOrAll();
                const content = (text || '').trim();
                if (!content) {
                    alert('내용을 입력하세요.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/summary`, {
                        content,
                    }); 
                    const out = (data?.result ?? data?.text ?? data?.checked ?? data?.styled_text ?? data?.translated ?? '').trim();
    if (!out) throw new Error('빈 결과');
                    apply(out);
                } catch (e) {
                    alert('요약 실패: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doExpand() {
                const { text, apply } = getQuillSelectionOrAll();
                const content = (text || '').trim();
                if (!content) {
                    alert('내용을 입력하세요.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/expand`, {
                        content,
                    }); 
                    const out = (data?.result ?? data?.text ?? data?.checked ?? data?.styled_text ?? data?.translated ?? '').trim();
    if (!out) throw new Error('빈 결과');
                    apply(out);
                } catch (e) {
                    alert('확장 실패: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doStyle() {
                const { text, apply } = getQuillSelectionOrAll();
                const content = (text || '').trim();
                const style = document.getElementById('styleSelector').value;

                if (!content) {
                    alert('내용을 입력하세요.');
                    return;
                }
                showSpin(true);

                try {
                    const data = await postJSON(`${BASE_URL}/gptStyleChange`, {
                        text: content,
                        style: style,
                    }); 
                    const out = (data?.result ?? data?.text ?? data?.checked ?? data?.styled_text ?? data?.translated ?? '').trim();
    if (!out) throw new Error('빈 결과');
                    apply(out);
                } catch (e) {
                    alert('문체변경 실패: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doHonorific() {
                const { text, apply } = getQuillSelectionOrAll();
                const content = (text || '').trim();
                if (!content) {
                    alert('내용을 입력하세요.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/cohereHonorific`, {
                        content,
                    });
                    const out = (data?.result ?? data?.text ?? data?.checked ?? data?.styled_text ?? data?.translated ?? '').trim();
    if (!out) throw new Error('빈 결과');
                    apply(out);
                } catch (e) {
                    alert('높임말 변환 실패: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doInformal() {
                const { text, apply } = getQuillSelectionOrAll();
                const content = (text || '').trim();
                if (!content) {
                    alert('내용을 입력하세요.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/cohereInformal`, {
                        content,
                    });
                    const out = (data?.result ?? data?.text ?? data?.checked ?? data?.styled_text ?? data?.translated ?? '').trim();
    if (!out) throw new Error('빈 결과');
                    apply(out);
                } catch (e) {
                    alert('반말 변환 실패: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doTranslate() {
                const { text, apply } = getQuillSelectionOrAll();
                const content = (text || '').trim();
                if (!content) {
                    alert('내용을 입력하세요.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/translate`, {
                        text: content,
                        source: 'auto',
                        target: 'en',
                    });
                    const out = (data?.result ?? data?.text ?? data?.checked ?? data?.styled_text ?? data?.translated ?? '').trim();
    if (!out) throw new Error('빈 결과');
                    apply(out);
                } catch (e) {
                    alert('번역 실패: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doOCRorFile() {
                
                const file = document.getElementById('file-input').files[0];
                if (!file) {
                    alert('파일을 선택하세요.');
                    return;
                }

                const form = new FormData();
                
                if (/\.(png|jpg|jpeg|bmp|tif|tiff)$/i.test(file.name)) {
                    form.append('image', file);
                    await uploadTo(`${BASE_URL}/visionOCR`, form, 'text');
                } else {
                    form.append('file', file);
                    await uploadTo(`${BASE_URL}/fileScan`, form, 'text');
                }
            }
            async function doGrammar() {
  const { text, apply } = getQuillSelectionOrAll(); 
  const content = (text || '').trim();
  if (!content) { alert('선택(또는 전체) 내용이 비어 있어요.'); return; }

  showSpin(true);
  try {
    const data = await postJSON(`${BASE_URL}/editorGrammar`, { content });

    const out = (data?.checked ?? data?.result ?? data?.text ?? '').trim();
    if (!out) throw new Error('빈 결과');


    apply(out);
  } catch (e) {
    alert('문법 교정 실패: ' + e.message);
  } finally {
    showSpin(false);
  }
}
            async function uploadTo(url, form, expectField = 'text') {
                showSpin(true);
                try {
                    const res = await fetch(url, {
                        method: 'POST',
                        body: form,
                    });
                    if (!res.ok) {
                        throw new Error(
                            `HTTP ${res.status} - ${await res.text()}`
                        );
                    }
                    const data = await res.json();
                    const text = (
                        data[expectField] ||
                        data.result ||
                        ''
                    ).toString();
                    setEditorText(text.trim());
                } catch (e) {
                    alert('불러오기 실패: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

       
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('btn-rewrite').onclick = doRewrite;
                document.getElementById('btn-summary').onclick = doSummary;
                document.getElementById('btn-expand').onclick = doExpand;
                document.getElementById('btn-style').onclick = doStyle;
                document.getElementById('btn-honorific').onclick = doHonorific;
                document.getElementById('btn-informal').onclick = doInformal;
                document.getElementById('btn-translate').onclick = doTranslate;
                document.getElementById('btn-grammar').onclick = doGrammar;
                document.getElementById('pdfDownloadBtn').onclick = saveAsPDF;
                document.getElementById('btn-ocr').onclick = doOCRorFile;
            });
        </script>

        <!-- Preloader -->
        <div id="preloader"></div>

        <!-- Vendor JS Files -->
        <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/vendor/php-email-form/validate.js"></script>
        <script src="assets/vendor/aos/aos.js"></script>
        <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
        <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
        <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
        <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

        <script src="assets/js/script.js"></script>
        <script src="assets/js/main.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
        <script>
            (function () {
                function setHeaderH() {
                    var h =
                        (document.getElementById('header') || {})
                            .offsetHeight || 64;
                    document.documentElement.style.setProperty(
                        '--header-h',
                        h + 'px'
                    );
                }
                window.addEventListener('load', setHeaderH);
                window.addEventListener('resize', setHeaderH);
                setHeaderH();
            })();

            async function saveAsPDF() {
                const content = quill.root; 
                html2pdf()
                    .set({
                        margin: 10,
                        filename: 'Editor PDF.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2 },
                        jsPDF: {
                            unit: 'mm',
                            format: 'a4',
                            orientation: 'portrait',
                        },
                    })
                    .from(content)
                    .save();
            }
        </script>
        <!-- Editor overlay spinner -->
<div id="edit_spinner" class="edit_spinner" aria-hidden="true">
  <div class="edit_spinner__backdrop"></div>
  <div class="edit_spinner__center" role="status" aria-live="polite" aria-label="처리 중">
    <div class="edit_spinner__ring"></div>
    <div class="edit_spinner__label">처리 중…</div>
  </div>
</div>

    </body>
</html>
