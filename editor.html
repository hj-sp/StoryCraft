<!DOCTYPE html>
<html lang="ko">
    <head>
        <script>
            window.emitter = window.emitter || { emit() {}, on() {}, off() {} };
        </script>
        <meta charset="utf-8" />
        <title>StoryCraft Editor</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />

        <!-- Favicons -->
        <link href="assets/img/favicon.png" rel="icon" />
        <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

        <!-- Fonts -->
        <link href="https://fonts.googleapis.com" rel="preconnect" />
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet"
        />

        <!-- Vendor CSS Files -->
        <link
            href="assets/vendor/bootstrap/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
            rel="stylesheet"
        />
        <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
        <link
            href="assets/vendor/glightbox/css/glightbox.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/swiper/swiper-bundle.min.css"
            rel="stylesheet"
        />
        <!-- Quill -->
        <link
            href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css"
            rel="stylesheet"
        />

        <!-- Main CSS File -->
        <link href="assets/css/main.css" rel="stylesheet" />
    </head>
    <body class="index-page page-editor">
        <header id="header" class="header d-flex align-items-center sticky-top">
            <div
                class="container position-relative d-flex align-items-center justify-content-between"
            >
                <a
                    href="index.html"
                    class="logo d-flex align-items-center me-auto me-xl-0"
                >
                    <!-- Uncomment the line below if you also wish to use an image logo -->
                    <!-- <img src="assets/img/logo.png" alt=""> -->
                    <h1 class="sitename">StoryCraft</h1>
                </a>

                <nav id="navmenu" class="navmenu">
                    <ul>
                        <!-- <li>
                            <a href="index.html#hero" class="active">Home</a>
                        </li>
                        <li><a href="index.html#about">About</a></li>
                        <li><a href="index.html#services">Services</a></li> -->
                        <li><a href="search.html">Search</a></li>
                        <li><a href="rewrite.html">Rewrite</a></li>
                        <li><a href="change-style.html">Style</a></li>
                        <li><a href="grammar.html">Grammar</a></li>
                        <li><a href="honorific.html">Honorific</a></li>
                        <li><a href="translate.html">Translate</a></li>
                        <li><a href="scan.html">Scan</a></li>
                        <li><a href="image.html">Image Scan</a></li>
                        <li><a href="speech.html">Speech</a></li>
                        <li><a href="editor.html" class="active">Editor</a></li>
                    </ul>
                    <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
                </nav>
            </div>
        </header>
        <div class="wrap">
            <!-- ÏóêÎîîÌÑ∞ Ïπ¥Îìú -->
            <div class="card editor-card">
                <div class="ql-frame">
                    <div class="toolbar">
                        <div id="quill-toolbar">
                            <span class="ql-formats">
                                <select class="ql-header">
                                    <option value="1"></option>
                                    <option value="2"></option>
                                    <option selected></option>
                                </select>
                                <select class="ql-font">
                                    <option value="malgun" selected></option>
                                    <option value="serif"></option>
                                    <option value="monospace"></option>
                                    <option value="batang"></option>
                                    <option value="gungsuh"></option>
                                    <option value="gulim"></option>
                                    <option value="noto-sans-kr"></option>
                                </select>
                                <select class="ql-size"></select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-bold"></button>
                                <button class="ql-italic"></button>
                                <button class="ql-underline"></button>
                                <button class="ql-strike"></button>
                            </span>
                            <span class="ql-formats">
                                <button
                                    class="ql-list"
                                    value="ordered"
                                ></button>
                                <button class="ql-list" value="bullet"></button>
                                <select class="ql-align"></select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-link"></button>
                                <button class="ql-blockquote"></button>
                                <button class="ql-code-block"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-clean"></button>
                            </span>
                            <span class="ql-formats">
                                <button
                                    type="button"
                                    id="btn-image"
                                    class="btn-image"
                                    title="Ïù¥ÎØ∏ÏßÄ"
                                >
                                    <i class="bi bi-image"></i>
                                </button>
                            </span>
                            <!-- <span class="ql-formats edit-upload">
                                <input
                                    id="ocrFile"
                                    type="file"
                                    accept="image/*,application/pdf"
                                    hidden
                                />
                                <label
                                    for="ocrFile"
                                    class="edit-upload__btn"
                                    title="ÌååÏùº ÏóÖÎ°úÎìú"
                                    aria-label="ÌååÏùº ÏóÖÎ°úÎìú"
                                >
                                    <i class="bi bi-folder-fill"></i
                                    ><span class="edit-upload__text"
                                        >ÌååÏùº ÏóÖÎ°úÎìú</span
                                    >
                                </label>
                                <span
                                    id="ocrFileName"
                                    class="edit-upload__name"
                                    hidden
                                ></span>
                            </span> -->
                            <span class="ql-formats">
                                <form id="uploadForm">
                                    <button
                                        id="editorStartRecord"
                                        type="button"
                                    >
                                        üéôÔ∏è
                                    </button>
                                    <button
                                        id="editorStopRecord"
                                        type="button"
                                        disabled
                                    >
                                        üõë
                                    </button>
                                    <button
                                        id="editorInsertRecord"
                                        type="button"
                                        disabled
                                    >
                                        ‚§µÔ∏è
                                    </button>
                                </form>
                            </span>
                            <span class="ql-formats" style="margin-left: auto">
                                <button id="editorPdfDownloadBtn">üíæ</button>
                            </span>
                        </div>
                    </div>
                    <div id="quill"></div>
                </div>

                <textarea id="userInput" style="display: none"></textarea>
                <input id="styleInput" type="hidden" />
                <input id="translateInput" type="hidden" />
            </div>

            <div id="scDrawerBackdrop" class="sc-drawer__backdrop" hidden></div>
            <aside id="scDrawer" class="sc-drawer" aria-hidden="true">
                <div class="sc-drawer__head">
                    <div id="scDrawerTitle" class="sc-drawer__title">
                        AI Panel
                    </div>
                    <button
                        id="scDrawerClose"
                        class="sc-drawer__close"
                        aria-label="close"
                    >
                        ‚úï
                    </button>
                </div>
                <div id="scDrawerBody" class="sc-drawer__body"></div>
                <div id="scDrawerFoot" class="sc-drawer__foot"></div>
            </aside>

            <!-- ÏÇ¨Ïù¥Îìú Ìà¥ Ìå®ÎÑê -->
        </div>
        <!-- Editor overlay spinner -->
        <div id="edit_spinner" class="edit_spinner" aria-hidden="true">
            <div class="edit_spinner__backdrop"></div>
            <div
                class="edit_spinner__center"
                role="status"
                aria-live="polite"
                aria-label="Ï≤òÎ¶¨ Ï§ë"
            >
                <div class="edit_spinner__ring"></div>
                <div class="edit_spinner__label">Ï≤òÎ¶¨ Ï§ë‚Ä¶</div>
            </div>
        </div>
        <div
            id="imgMenu"
            class="img-menu"
            aria-hidden="true"
            role="menu"
            aria-labelledby="btn-image"
        >
            <div class="img-menu__title">Îã§ÏùåÏóêÏÑú Í∑∏Î¶º ÏÇΩÏûÖ:</div>
            <button
                type="button"
                id="imgMenu-insert"
                class="img-menu__item"
                role="menuitem"
            >
                <i class="bi bi-image"></i> Ïù¥ÎØ∏ÏßÄ ÏÇΩÏûÖ
            </button>
            <button
                type="button"
                id="imgMenu-ocr"
                class="img-menu__item"
                role="menuitem"
            >
                <i class="bi bi-file-earmark-text"></i> ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú
            </button>
            <!-- Ïà®Í≤®ÏßÑ ÌååÏùº inputÏùÑ ÎØ∏Î¶¨ DOMÏóê Ï∂îÍ∞Ä -->
            <input
                type="file"
                id="ocrFileInput"
                accept="
    image/*,
    .pdf,.doc,.docx,.hwp,.hwpx,.xls,.xlsx,.ppt,.pptx,.txt,
    application/pdf,
    application/msword,
    application/vnd.openxmlformats-officedocument.wordprocessingml.document,
    application/haansoft-hwp,
    application/vnd.hancom.hwpx+zip,
    application/vnd.ms-excel,
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,
    application/vnd.ms-powerpoint,
    application/vnd.openxmlformats-officedocument.presentationml.presentation,
    text/plain
  "
                style="display: none"
            />
        </div>
        <!-- OCR Í≤∞Í≥º ÌåùÏóÖ -->
        <div
            id="ocrModal"
            class="ocr-modal"
            aria-hidden="true"
            role="dialog"
            aria-modal="true"
        >
            <div class="ocr-modal__dialog">
                <div class="ocr-modal__header">
                    <strong>Ïù¥ÎØ∏ÏßÄ ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú</strong>
                    <button
                        type="button"
                        id="ocrClose"
                        class="ocr-modal__close"
                        aria-label="Îã´Í∏∞"
                    >
                        ‚úï
                    </button>
                </div>
                <!-- <div class="ocr-modal__body">
                    <textarea
                        id="ocrText"
                        class="ocr-modal__textarea"
                        placeholder="Ïó¨Í∏∞Ïóê Ï∂îÏ∂úÎêú ÌÖçÏä§Ìä∏Í∞Ä ÌëúÏãúÎê©ÎãàÎã§‚Ä¶"
                    ></textarea>
                </div> -->
                <div class="editor_image_container">
                    <div class="card editor-card">
                        <div>
                            <div id="quill2" class="editor_quill2 editor"></div>
                        </div>

                        <!-- <textarea id="userInput2" style="display: none"></textarea>
                        <input id="styleInput2" type="hidden" />
                        <input id="translateInput2" type="hidden" /> -->
                    </div>
                    <div class="editor_image_prompt_container">
                        <textarea
                            id="imagePromptText"
                            class="editor_image_prompt_input"
                            rows="3"
                            cols="50"
                            placeholder="ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                        ></textarea>

                        <div>
                            <button
                                class="editor_image_prompt_insert"
                                id="image-prompt-change"
                            >
                                ‚¨Ü
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="ocrInsert" type="button" class="insert-btn">
                        ÌÖçÏä§Ìä∏ ÏÇΩÏûÖ
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Floating Tool Dock -->
        <nav class="sc-dock" id="scDock" aria-label="AI tools">
            <!-- 1) ÌîÑÎ°¨ÌîÑÌä∏ -->
            <button
                class="sc-dock__btn"
                data-action="prompt"
                data-title="AI ÌîÑÎ°¨ÌîÑÌä∏"
                aria-label="AI ÌîÑÎ°¨ÌîÑÌä∏"
            >
                <!-- chat bubble -->
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path
                        d="M21 15a4 4 0 0 1-4 4H8l-5 5V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"
                    />
                </svg>
                <span class="sc-tip">AI ÌîÑÎ°¨ÌîÑÌä∏</span>
            </button>

            <!-- 2) Î≤àÏó≠ -->
            <button
                class="sc-dock__btn"
                data-action="translate"
                aria-label="Î≤àÏó≠"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M4 5h16M9 3v2m6-2v2M5 8h14l-7 13z" />
                </svg>
                <span class="sc-tip">Î≤àÏó≠</span>
            </button>

            <!-- 3) Î¨∏Ï≤¥Î≥ÄÍ≤Ω -->
            <button
                class="sc-dock__btn"
                data-action="style"
                aria-label="Î¨∏Ï≤¥Î≥ÄÍ≤Ω"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M4 20h16M7 20l5-16 5 16M10 14h8" />
                </svg>
                <span class="sc-tip">Î¨∏Ï≤¥Î≥ÄÍ≤Ω</span>
            </button>

            <!-- 4) ÎÜíÏûÑÎßê -->
            <button
                class="sc-dock__btn"
                data-action="honorific"
                aria-label="ÎÜíÏûÑÎßê"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <circle cx="12" cy="7" r="4" />
                    <path d="M6 21v-2a6 6 0 0 1 12 0v2" />
                </svg>
                <span class="sc-tip">ÎÜíÏûÑÎßê</span>
            </button>

            <!-- 5) Î∞òÎßê -->
            <button
                class="sc-dock__btn"
                data-action="informal"
                aria-label="Î∞òÎßê"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M21 15a4 4 0 0 1-4 4H8l-5 5V7a4 4 0 0 1 4-4h5" />
                </svg>
                <span class="sc-tip">Î∞òÎßê</span>
            </button>

            <!-- 6) Ïû¨ÏûëÏÑ± -->
            <button
                class="sc-dock__btn"
                data-action="rewrite"
                aria-label="Ïû¨ÏûëÏÑ±"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M3 7h13M3 12h9M3 17h6M21 7l-4 4 4 4" />
                </svg>
                <span class="sc-tip">Ïû¨ÏûëÏÑ±</span>
            </button>

            <!-- 7) ÏöîÏïΩ -->
            <button
                class="sc-dock__btn"
                data-action="summary"
                aria-label="ÏöîÏïΩ"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M4 4h16v16H4z" />
                    <path d="M8 8h8M8 12h5" />
                </svg>
                <span class="sc-tip">ÏöîÏïΩ</span>
            </button>

            <!-- 8) ÌôïÏû• -->
            <button class="sc-dock__btn" data-action="expand" aria-label="ÌôïÏû•">
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M3 10h7V3M21 14h-7v7M3 3l7 7M21 21l-7-7" />
                </svg>
                <span class="sc-tip">ÌôïÏû•</span>
            </button>

            <!-- 9) Î¨∏Î≤ï ÍµêÏ†ï -->
            <button
                class="sc-dock__btn"
                data-action="grammar"
                aria-label="Î¨∏Î≤ï ÍµêÏ†ï"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path
                        d="M4 19.5V6a2 2 0 0 1 2-2h8l6 6v9.5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z"
                    />
                    <path d="M14 4v4h4" />
                    <path d="M9 15l2 2 4-4" />
                </svg>
                <span class="sc-tip">Î¨∏Î≤ï ÍµêÏ†ï</span>
            </button>
        </nav>
        <!-- ÌïòÎÇòÏùò ÌÅ∞ ÎùºÎ≤® Î∞ïÏä§ -->
        <aside id="scDockLabels" class="sc-dock__labels" aria-hidden="true">
            <div class="sc-dock__labelcol">
                <div class="sc-dock__label">AI ÌîÑÎ°¨ÌîÑÌä∏</div>
                <div class="sc-dock__label">Î≤àÏó≠</div>
                <div class="sc-dock__label">Î¨∏Ï≤¥Î≥ÄÍ≤Ω</div>
                <div class="sc-dock__label">ÎÜíÏûÑÎßê</div>
                <div class="sc-dock__label">Î∞òÎßê</div>
                <div class="sc-dock__label">Ïû¨ÏûëÏÑ±</div>
                <div class="sc-dock__label">ÏöîÏïΩ</div>
                <div class="sc-dock__label">ÌôïÏû•</div>
                <div class="sc-dock__label">Î¨∏Î≤ï ÍµêÏ†ï</div>
            </div>
        </aside>
        <div id="customContextMenu" class="custom-context-menu" hidden>
            <button data-action="style" class="has-submenu">Î¨∏Ï≤¥ Î≥ÄÍ≤Ω ‚ñ∏</button>
            <button data-action="translate" class="has-submenu">Î≤àÏó≠ ‚ñ∏</button>
            <button data-action="summary">ÏöîÏïΩ</button>
            <button data-action="expand">ÌôïÏû•</button>
            <button data-action="honorific">ÎÜíÏûÑÎßê</button>
            <button data-action="informal">Î∞òÎßê</button>
            <button data-action="rewrite">Ïû¨ÏûëÏÑ±</button>
            <button data-action="grammar">Î¨∏Î≤ï ÍµêÏ†ï</button>

            <!-- Î¨∏Ï≤¥ Î≥ÄÍ≤Ω ÏÑúÎ∏åÎ©îÎâ¥ -->
            <div id="styleSubmenu" class="submenu" hidden>
                <button data-subaction="casual">Íµ¨Ïñ¥Ï≤¥</button>
                <button data-subaction="formal">Í≤©ÏãùÏ≤¥</button>
                <button data-subaction="literary">Î¨∏ÌïôÏ≤¥</button>
                <button data-subaction="academic">ÌïôÏà†Ï≤¥</button>
            </div>
            <!-- Î≤àÏó≠ ÏÑúÎ∏åÎ©îÎâ¥ -->
            <div id="translateSubmenu" class="submenu" hidden>
                <button data-subaction="gu">Íµ¨ÏûêÎùºÌä∏Ïñ¥</button>
                <button data-subaction="el">Í∑∏Î¶¨Ïä§Ïñ¥</button>
                <button data-subaction="ne">ÎÑ§ÌåîÏñ¥</button>
                <button data-subaction="nl">ÎÑ§ÎçúÎûÄÎìúÏñ¥</button>
                <button data-subaction="de">ÎèÖÏùºÏñ¥</button>
                <button data-subaction="ru">Îü¨ÏãúÏïÑÏñ¥</button>
                <button data-subaction="ro">Î£®ÎßàÎãàÏïÑÏñ¥</button>
                <button data-subaction="mr">ÎßàÎùºÌã∞Ïñ¥</button>
                <button data-subaction="ms">ÎßêÎ†àÏù¥Ïñ¥</button>
                <button data-subaction="vi">Î≤†Ìä∏ÎÇ®Ïñ¥</button>
                <button data-subaction="bn">Î≤µÍ≥®Ïñ¥</button>
                <button data-subaction="sv">Ïä§Ïõ®Îç¥Ïñ¥</button>
                <button data-subaction="es">Ïä§ÌéòÏù∏Ïñ¥</button>
                <button data-subaction="af">ÏïÑÌîÑÎ¶¨Ïπ∏Ïä§Ïñ¥</button>
                <button data-subaction="ar">ÏïÑÎûçÏñ¥</button>
                <button data-subaction="en">ÏòÅÏñ¥</button>
                <button data-subaction="uk">Ïö∞ÌÅ¨ÎùºÏù¥ÎÇòÏñ¥</button>
                <button data-subaction="it">Ïù¥ÌÉàÎ¶¨ÏïÑÏñ¥</button>
                <button data-subaction="ja">ÏùºÎ≥∏Ïñ¥</button>
                <button data-subaction="jv">ÏûêÎ∞îÏñ¥</button>
                <button data-subaction="ka">Ï°∞ÏßÄÏïÑÏñ¥</button>
                <button data-subaction="zh-CN">Ï§ëÍµ≠Ïñ¥(Í∞ÑÏ≤¥)</button>
                <button data-subaction="zh-TW">Ï§ëÍµ≠Ïñ¥(Î≤àÏ≤¥)</button>
                <button data-subaction="ta">ÌÉÄÎ∞ÄÏñ¥</button>
                <button data-subaction="th">ÌÉúÍµ≠Ïñ¥</button>
                <button data-subaction="tr">ÌÑ∞ÌÇ§Ïñ¥</button>
                <button data-subaction="fa">ÌéòÎ•¥ÏãúÏïÑÏñ¥</button>
                <button data-subaction="pt">Ìè¨Î•¥Ìà¨Í∞àÏñ¥</button>
                <button data-subaction="pl">Ìè¥ÎûÄÎìúÏñ¥</button>
                <button data-subaction="fr">ÌîÑÎûëÏä§Ïñ¥</button>
                <button data-subaction="ko">ÌïúÍµ≠Ïñ¥</button>
                <button data-subaction="hi">ÌûåÎîîÏñ¥</button>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/quill-blot-formatter@1.0.5/dist/quill-blot-formatter.min.js"></script>

        <script>
            // ÌîåÎü¨Í∑∏Ïù∏ Îì±Î°ù
            if (window.QuillBlotFormatter) {
                Quill.register(
                    'modules/blotFormatter',
                    window.QuillBlotFormatter.default ||
                        window.QuillBlotFormatter
                );
            }
        </script>

        <!-- Preloader -->
        <div id="preloader"></div>

        <!-- Vendor JS Files -->
        <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/vendor/php-email-form/validate.js"></script>
        <script src="assets/vendor/aos/aos.js"></script>
        <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
        <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
        <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
        <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

        <script src="assets/js/main.js"></script>
        <script src="assets/js/script.js?v=20251003"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

        <script>
            (function () {
                (function setupErrorLogger() {
                    const tag = (t) => `%c${t}`;
                    const style = 'color:#e11d48;font-weight:600';
                    window.addEventListener('error', (e) => {
                        console.log(
                            tag('[JS error]'),
                            style,
                            e.message,
                            e.filename,
                            e.lineno,
                            e.colno
                        );
                    });
                    window.addEventListener('unhandledrejection', (e) => {
                        console.log(
                            tag('[Promise rejection]'),
                            style,
                            e.reason
                        );
                    });
                })();

                window.SCTPL = window.SCTPL || {};
                window.registerTemplates =
                    window.registerTemplates ||
                    function (T) {
                        if (T && typeof T === 'object')
                            Object.assign(window.SCTPL, T);
                    };
                try {
                    if (typeof TPL === 'object' && TPL)
                        Object.assign(window.SCTPL, TPL);
                } catch (e) {
                    console.error('[tpl publish]', e);
                }
                window.SCTPL.prompt ??= {
                    title: 'AI ÌîÑÎ°¨ÌîÑÌä∏',
                    body: '<div style="padding:8px 0">Î°úÎî©‚Ä¶</div>',
                    foot: '',
                };

                /* Ïú†Ìã∏ */
                function titleFrom(btn) {
                    return (
                        btn?.dataset.title ||
                        btn?.getAttribute?.('aria-label') ||
                        btn?.querySelector?.('.sc-tip')?.textContent ||
                        'AI Panel'
                    ).trim();
                }
                const getTpl = (key) =>
                    (window.SCTPL && window.SCTPL[key]) || null;

                /*  Ìå®ÎÑê DOM Î≥¥Ïû• */
                function ensureInlineDrawer() {
                    let drawer = document.getElementById('scDrawer');
                    let backdrop = document.getElementById('scDrawerBackdrop');
                    const wrap = document.querySelector('.wrap');
                    if (!drawer) {
                        backdrop = document.createElement('div');
                        backdrop.id = 'scDrawerBackdrop';
                        backdrop.className = 'sc-drawer__backdrop';
                        backdrop.hidden = true;

                        drawer = document.createElement('aside');
                        drawer.id = 'scDrawer';
                        drawer.className = 'sc-drawer';
                        drawer.setAttribute('aria-hidden', 'true');
                        drawer.innerHTML = `
        <div class="sc-drawer__head">
          <div id="scDrawerTitle" class="sc-drawer__title">AI Panel</div>
          <button id="scDrawerClose" class="sc-drawer__close" aria-label="close">‚úï</button>
        </div>
        <div id="scDrawerBody" class="sc-drawer__body"></div>
        <div id="scDrawerFoot" class="sc-drawer__foot"></div>
      `;
                        (wrap || document.body).append(backdrop, drawer);
                    }
                    return drawer;
                }
                function closeDrawer() {
                    const wrap = document.querySelector('.wrap');
                    const drawer = document.getElementById('scDrawer');
                    drawer?.classList.remove('open');
                    drawer?.setAttribute('aria-hidden', 'true');
                    wrap?.classList.remove('with-panel');
                }

                function openSimple(key = 'summary', btn) {
                    const drawer = ensureInlineDrawer();
                    const wrap = document.querySelector('.wrap');
                    const titleEl = document.getElementById('scDrawerTitle');
                    const body = document.getElementById('scDrawerBody');
                    const foot = document.getElementById('scDrawerFoot');

                    if (titleEl)
                        titleEl.textContent = titleFrom(btn) || 'AI Panel';
                    drawer.dataset.key = key || 'summary';
                    drawer.classList.add('open');
                    drawer.setAttribute('aria-hidden', 'false');
                    wrap?.classList.add('with-panel');

                    const tpl = getTpl(key);
                    if (body) {
                        body.innerHTML =
                            tpl?.body ||
                            `
        <div style="padding:10px 0; color:#6b7280; line-height:1.6">
          <p><b>${
              titleFrom(btn) || 'AI Panel'
          }</b> Ìå®ÎÑêÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§.</p>
          <p>ÎßåÏïΩ Í≥ÑÏÜç Ïù¥ ÏÉÅÌÉúÎ©¥ <code>assets/js/script.js</code> Ï¥àÍ∏∞Ìôî ÏóêÎü¨Ïùº Ïàò ÏûàÏñ¥Ïöî.</p>
        </div>
      `;
                    }
                    if (foot) foot.innerHTML = tpl?.foot || '';
                }
                window.DEBUG_OPEN_DRAWER_FALLBACK = openSimple;

                if (typeof window.DEBUG_OPEN_DRAWER !== 'function') {
                    window.DEBUG_OPEN_DRAWER =
                        window.DEBUG_OPEN_DRAWER_FALLBACK;
                }

                function openBridge(key = 'summary', btn) {
                    const main = window.DEBUG_OPEN_DRAWER;
                    if (
                        typeof main === 'function' &&
                        main !== window.DEBUG_OPEN_DRAWER_FALLBACK
                    ) {
                        return main(key, btn);
                    }
                    return window.DEBUG_OPEN_DRAWER_FALLBACK(key, btn);
                }

                (function bindDock() {
                    const dockById = document.getElementById('scDock');
                    const dockByClass = document.querySelector('.sc-dock');

                    function onDockClick(e) {
                        const btn = e.target.closest?.('.sc-dock__btn');
                        if (!btn) return;
                        const key = btn.dataset.action || 'prompt';
                        openBridge(key, btn);
                    }
                    dockById?.addEventListener('click', onDockClick);
                    dockByClass?.addEventListener('click', onDockClick);

                    document.addEventListener('click', (e) => {
                        const btn = e.target.closest?.('.sc-dock__btn');
                        if (!btn) return;
                        onDockClick(e);
                    });
                })();

                document.addEventListener('click', (e) => {
                    if (
                        !e.target.closest?.('#scDrawerClose') &&
                        e.target.id !== 'scDrawerBackdrop'
                    )
                        return;
                    closeDrawer();
                });
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') closeDrawer();
                });
            })();
        </script>
    </body>
</html>
