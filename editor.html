<!DOCTYPE html>
<html lang="ko">
    <head>
        <script>
            window.emitter = window.emitter || { emit() {}, on() {}, off() {} };
        </script>
        <meta charset="utf-8" />
        <title>StoryCraft Editor</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />

        <!-- Favicons -->
        <link href="assets/img/favicon.png" rel="icon" />
        <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

        <!-- Fonts -->
        <link href="https://fonts.googleapis.com" rel="preconnect" />
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet"
        />

        <!-- Vendor CSS Files -->
        <link
            href="assets/vendor/bootstrap/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
            rel="stylesheet"
        />
        <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
        <link
            href="assets/vendor/glightbox/css/glightbox.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/swiper/swiper-bundle.min.css"
            rel="stylesheet"
        />
        <!-- Quill -->
        <link
            href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css"
            rel="stylesheet"
        />

        <!-- Main CSS File -->
        <link href="assets/css/main.css" rel="stylesheet" />
    </head>
    <body class="index-page page-editor">
        <header id="header" class="header d-flex align-items-center sticky-top">
            <div
                class="container position-relative d-flex align-items-center justify-content-between"
            >
                <a
                    href="index.html"
                    class="logo d-flex align-items-center me-auto me-xl-0"
                >
                    <!-- Uncomment the line below if you also wish to use an image logo -->
                    <!-- <img src="assets/img/logo.png" alt=""> -->
                    <h1 class="sitename">StoryCraft</h1>
                </a>

                <nav id="navmenu" class="navmenu">
                    <ul>
                        <!-- <li>
                            <a href="index.html#hero" class="active">Home</a>
                        </li>
                        <li><a href="index.html#about">About</a></li>
                        <li><a href="index.html#services">Services</a></li> -->
                        <li><a href="search.html">Search</a></li>
                        <li><a href="rewrite.html">Rewrite</a></li>
                        <li><a href="change-style.html">Style</a></li>
                        <li><a href="grammar.html">Grammar</a></li>
                        <li><a href="honorific.html">Honorific</a></li>
                        <li><a href="translate.html">Translate</a></li>
                        <li><a href="scan.html">Scan</a></li>
                        <li><a href="image.html">Image Scan</a></li>
                        <li><a href="speech.html">Speech</a></li>
                        <li><a href="editor.html" class="active">Editor</a></li>
                    </ul>
                    <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
                </nav>
            </div>
        </header>
        <div class="wrap">
            <!-- ì—ë””í„° ì¹´ë“œ -->
            <div class="card editor-card">
                <div class="ql-frame">
                    <div class="toolbar">
                        <div id="quill-toolbar">
                            <span class="ql-formats">
                                <select class="ql-header">
                                    <option value="1"></option>
                                    <option value="2"></option>
                                    <option selected></option>
                                </select>
                                <select class="ql-font">
                                    <option value="malgun" selected></option>
                                    <option value="serif"></option>
                                    <option value="monospace"></option>
                                    <option value="batang"></option>
                                    <option value="gungsuh"></option>
                                    <option value="gulim"></option>
                                    <option value="noto-sans-kr"></option>
                                </select>
                                <select class="ql-size"></select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-bold"></button>
                                <button class="ql-italic"></button>
                                <button class="ql-underline"></button>
                                <button class="ql-strike"></button>
                            </span>
                            <span class="ql-formats">
                                <button
                                    class="ql-list"
                                    value="ordered"
                                ></button>
                                <button class="ql-list" value="bullet"></button>
                                <select class="ql-align"></select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-link"></button>
                                <button class="ql-blockquote"></button>
                                <button class="ql-code-block"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-clean"></button>
                            </span>
                            <span class="ql-formats">
                                <button
                                    type="button"
                                    id="btn-image"
                                    class="btn-image"
                                    title="ì´ë¯¸ì§€"
                                >
                                    <i class="bi bi-image"></i>
                                </button>
                            </span>
                            <!-- <span class="ql-formats edit-upload">
                                <input
                                    id="ocrFile"
                                    type="file"
                                    accept="image/*,application/pdf"
                                    hidden
                                />
                                <label
                                    for="ocrFile"
                                    class="edit-upload__btn"
                                    title="íŒŒì¼ ì—…ë¡œë“œ"
                                    aria-label="íŒŒì¼ ì—…ë¡œë“œ"
                                >
                                    <i class="bi bi-folder-fill"></i
                                    ><span class="edit-upload__text"
                                        >íŒŒì¼ ì—…ë¡œë“œ</span
                                    >
                                </label>
                                <span
                                    id="ocrFileName"
                                    class="edit-upload__name"
                                    hidden
                                ></span>
                            </span> -->
                            <span class="ql-formats">
                                <form id="uploadForm">
                                    <button
                                        id="editorStartRecord"
                                        type="button"
                                    >
                                        ğŸ™ï¸
                                    </button>
                                    <button
                                        id="editorStopRecord"
                                        type="button"
                                        disabled
                                    >
                                        ğŸ›‘
                                    </button>
                                    <button
                                        id="editorInsertRecord"
                                        type="button"
                                        disabled
                                    >
                                        â¤µï¸
                                    </button>
                                </form>
                            </span>
                            <span class="ql-formats" style="margin-left: auto">
                                <button id="editorPdfDownloadBtn">ğŸ’¾</button>
                            </span>
                        </div>
                    </div>
                    <div id="quill"></div>
                </div>

                <textarea id="userInput" style="display: none"></textarea>
                <input id="styleInput" type="hidden" />
                <input id="translateInput" type="hidden" />
            </div>

            <div id="scDrawerBackdrop" class="sc-drawer__backdrop" hidden></div>
            <aside id="scDrawer" class="sc-drawer" aria-hidden="true">
                <div class="sc-drawer__head">
                    <div id="scDrawerTitle" class="sc-drawer__title">
                        AI Panel
                    </div>
                    <button
                        id="scDrawerClose"
                        class="sc-drawer__close"
                        aria-label="close"
                    >
                        âœ•
                    </button>
                </div>
                <div id="scDrawerBody" class="sc-drawer__body"></div>
                <div id="scDrawerFoot" class="sc-drawer__foot"></div>
            </aside>

            <!-- ì‚¬ì´ë“œ íˆ´ íŒ¨ë„ -->
        </div>
        <!-- Editor overlay spinner -->
        <div id="edit_spinner" class="edit_spinner" aria-hidden="true">
            <div class="edit_spinner__backdrop"></div>
            <div
                class="edit_spinner__center"
                role="status"
                aria-live="polite"
                aria-label="ì²˜ë¦¬ ì¤‘"
            >
                <div class="edit_spinner__ring"></div>
                <div class="edit_spinner__label">ì²˜ë¦¬ ì¤‘â€¦</div>
            </div>
        </div>
        <div
            id="imgMenu"
            class="img-menu"
            aria-hidden="true"
            role="menu"
            aria-labelledby="btn-image"
        >
            <div class="img-menu__title">ë‹¤ìŒì—ì„œ ê·¸ë¦¼ ì‚½ì…:</div>
            <button
                type="button"
                id="imgMenu-insert"
                class="img-menu__item"
                role="menuitem"
            >
                <i class="bi bi-image"></i> ì´ë¯¸ì§€ ì‚½ì…
            </button>
            <button
                type="button"
                id="imgMenu-ocr"
                class="img-menu__item"
                role="menuitem"
            >
                <i class="bi bi-file-earmark-text"></i> í…ìŠ¤íŠ¸ ì¶”ì¶œ
            </button>
            <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ inputì„ ë¯¸ë¦¬ DOMì— ì¶”ê°€ -->
            <input
                type="file"
                id="ocrFileInput"
                accept="
    image/*,
    .pdf,.doc,.docx,.hwp,.hwpx,.xls,.xlsx,.ppt,.pptx,.txt,
    application/pdf,
    application/msword,
    application/vnd.openxmlformats-officedocument.wordprocessingml.document,
    application/haansoft-hwp,
    application/vnd.hancom.hwpx+zip,
    application/vnd.ms-excel,
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,
    application/vnd.ms-powerpoint,
    application/vnd.openxmlformats-officedocument.presentationml.presentation,
    text/plain
  "
                style="display: none"
            />
        </div>
        <!-- OCR ê²°ê³¼ íŒì—… -->
        <div
            id="ocrModal"
            class="ocr-modal"
            aria-hidden="true"
            role="dialog"
            aria-modal="true"
        >
            <div class="ocr-modal__dialog">
                <div class="ocr-modal__header">
                    <strong>ì´ë¯¸ì§€ í…ìŠ¤íŠ¸ ì¶”ì¶œ</strong>
                    <button
                        type="button"
                        id="ocrClose"
                        class="ocr-modal__close"
                        aria-label="ë‹«ê¸°"
                    >
                        âœ•
                    </button>
                </div>
                <!-- <div class="ocr-modal__body">
                    <textarea
                        id="ocrText"
                        class="ocr-modal__textarea"
                        placeholder="ì—¬ê¸°ì— ì¶”ì¶œëœ í…ìŠ¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤â€¦"
                    ></textarea>
                </div> -->
                <div class="editor_image_container">
                    <div class="card editor-card">
                        <div>
                            <div id="quill2" class="editor_quill2 editor"></div>
                        </div>

                        <!-- <textarea id="userInput2" style="display: none"></textarea>
                        <input id="styleInput2" type="hidden" />
                        <input id="translateInput2" type="hidden" /> -->
                    </div>
                    <div class="editor_image_prompt_container">
                        <textarea
                            id="imagePromptText"
                            class="editor_image_prompt_input"
                            rows="3"
                            cols="50"
                            placeholder="í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        ></textarea>

                        <div>
                            <button
                                class="editor_image_prompt_insert"
                                id="image-prompt-change"
                            >
                                â¬†
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="ocrInsert" type="button" class="insert-btn">
                        í…ìŠ¤íŠ¸ ì‚½ì…
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Floating Tool Dock -->
        <nav class="sc-dock" id="scDock" aria-label="AI tools">
            <!-- 1) í”„ë¡¬í”„íŠ¸ -->
            <button
                class="sc-dock__btn"
                data-action="prompt"
                data-title="AI í”„ë¡¬í”„íŠ¸"
                aria-label="AI í”„ë¡¬í”„íŠ¸"
            >
                <!-- chat bubble -->
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path
                        d="M21 15a4 4 0 0 1-4 4H8l-5 5V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"
                    />
                </svg>
                <span class="sc-tip">AI í”„ë¡¬í”„íŠ¸</span>
            </button>

            <!-- 2) ë²ˆì—­ -->
            <button
                class="sc-dock__btn"
                data-action="translate"
                aria-label="ë²ˆì—­"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M4 5h16M9 3v2m6-2v2M5 8h14l-7 13z" />
                </svg>
                <span class="sc-tip">ë²ˆì—­</span>
            </button>

            <!-- 3) ë¬¸ì²´ë³€ê²½ -->
            <button
                class="sc-dock__btn"
                data-action="style"
                aria-label="ë¬¸ì²´ë³€ê²½"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M4 20h16M7 20l5-16 5 16M10 14h8" />
                </svg>
                <span class="sc-tip">ë¬¸ì²´ë³€ê²½</span>
            </button>

            <!-- 4) ë†’ì„ë§ -->
            <button
                class="sc-dock__btn"
                data-action="honorific"
                aria-label="ë†’ì„ë§"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <circle cx="12" cy="7" r="4" />
                    <path d="M6 21v-2a6 6 0 0 1 12 0v2" />
                </svg>
                <span class="sc-tip">ë†’ì„ë§</span>
            </button>

            <!-- 5) ë°˜ë§ -->
            <button
                class="sc-dock__btn"
                data-action="informal"
                aria-label="ë°˜ë§"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M21 15a4 4 0 0 1-4 4H8l-5 5V7a4 4 0 0 1 4-4h5" />
                </svg>
                <span class="sc-tip">ë°˜ë§</span>
            </button>

            <!-- 6) ì¬ì‘ì„± -->
            <button
                class="sc-dock__btn"
                data-action="rewrite"
                aria-label="ì¬ì‘ì„±"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M3 7h13M3 12h9M3 17h6M21 7l-4 4 4 4" />
                </svg>
                <span class="sc-tip">ì¬ì‘ì„±</span>
            </button>

            <!-- 7) ìš”ì•½ -->
            <button
                class="sc-dock__btn"
                data-action="summary"
                aria-label="ìš”ì•½"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M4 4h16v16H4z" />
                    <path d="M8 8h8M8 12h5" />
                </svg>
                <span class="sc-tip">ìš”ì•½</span>
            </button>

            <!-- 8) í™•ì¥ -->
            <button class="sc-dock__btn" data-action="expand" aria-label="í™•ì¥">
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path d="M3 10h7V3M21 14h-7v7M3 3l7 7M21 21l-7-7" />
                </svg>
                <span class="sc-tip">í™•ì¥</span>
            </button>

            <!-- 9) ë¬¸ë²• êµì • -->
            <button
                class="sc-dock__btn"
                data-action="grammar"
                aria-label="ë¬¸ë²• êµì •"
            >
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="#2e7d6b"
                    stroke-width="2"
                >
                    <path
                        d="M4 19.5V6a2 2 0 0 1 2-2h8l6 6v9.5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z"
                    />
                    <path d="M14 4v4h4" />
                    <path d="M9 15l2 2 4-4" />
                </svg>
                <span class="sc-tip">ë¬¸ë²• êµì •</span>
            </button>
        </nav>
        <!-- í•˜ë‚˜ì˜ í° ë¼ë²¨ ë°•ìŠ¤ -->
        <aside id="scDockLabels" class="sc-dock__labels" aria-hidden="true">
            <div class="sc-dock__labelcol">
                <div class="sc-dock__label">AI í”„ë¡¬í”„íŠ¸</div>
                <div class="sc-dock__label">ë²ˆì—­</div>
                <div class="sc-dock__label">ë¬¸ì²´ë³€ê²½</div>
                <div class="sc-dock__label">ë†’ì„ë§</div>
                <div class="sc-dock__label">ë°˜ë§</div>
                <div class="sc-dock__label">ì¬ì‘ì„±</div>
                <div class="sc-dock__label">ìš”ì•½</div>
                <div class="sc-dock__label">í™•ì¥</div>
                <div class="sc-dock__label">ë¬¸ë²• êµì •</div>
            </div>
        </aside>
        <div id="customContextMenu" class="custom-context-menu" hidden>
            <button data-action="style" class="has-submenu">ë¬¸ì²´ ë³€ê²½ â–¸</button>
            <button data-action="translate" class="has-submenu">ë²ˆì—­ â–¸</button>
            <button data-action="summary">ìš”ì•½</button>
            <button data-action="expand">í™•ì¥</button>
            <button data-action="honorific">ë†’ì„ë§</button>
            <button data-action="informal">ë°˜ë§</button>
            <button data-action="rewrite">ì¬ì‘ì„±</button>
            <button data-action="grammar">ë¬¸ë²• êµì •</button>

            <!-- ë¬¸ì²´ ë³€ê²½ ì„œë¸Œë©”ë‰´ -->
            <div id="styleSubmenu" class="submenu" hidden>
                <button data-subaction="casual">êµ¬ì–´ì²´</button>
                <button data-subaction="formal">ê²©ì‹ì²´</button>
                <button data-subaction="literary">ë¬¸í•™ì²´</button>
                <button data-subaction="academic">í•™ìˆ ì²´</button>
            </div>
            <!-- ë²ˆì—­ ì„œë¸Œë©”ë‰´ -->
            <div id="translateSubmenu" class="submenu" hidden>
                <button data-subaction="gu">êµ¬ìë¼íŠ¸ì–´</button>
                <button data-subaction="el">ê·¸ë¦¬ìŠ¤ì–´</button>
                <button data-subaction="ne">ë„¤íŒ”ì–´</button>
                <button data-subaction="nl">ë„¤ëœë€ë“œì–´</button>
                <button data-subaction="de">ë…ì¼ì–´</button>
                <button data-subaction="ru">ëŸ¬ì‹œì•„ì–´</button>
                <button data-subaction="ro">ë£¨ë§ˆë‹ˆì•„ì–´</button>
                <button data-subaction="mr">ë§ˆë¼í‹°ì–´</button>
                <button data-subaction="ms">ë§ë ˆì´ì–´</button>
                <button data-subaction="vi">ë² íŠ¸ë‚¨ì–´</button>
                <button data-subaction="bn">ë²µê³¨ì–´</button>
                <button data-subaction="sv">ìŠ¤ì›¨ë´ì–´</button>
                <button data-subaction="es">ìŠ¤í˜ì¸ì–´</button>
                <button data-subaction="af">ì•„í”„ë¦¬ì¹¸ìŠ¤ì–´</button>
                <button data-subaction="ar">ì•„ëì–´</button>
                <button data-subaction="en">ì˜ì–´</button>
                <button data-subaction="uk">ìš°í¬ë¼ì´ë‚˜ì–´</button>
                <button data-subaction="it">ì´íƒˆë¦¬ì•„ì–´</button>
                <button data-subaction="ja">ì¼ë³¸ì–´</button>
                <button data-subaction="jv">ìë°”ì–´</button>
                <button data-subaction="ka">ì¡°ì§€ì•„ì–´</button>
                <button data-subaction="zh-CN">ì¤‘êµ­ì–´(ê°„ì²´)</button>
                <button data-subaction="zh-TW">ì¤‘êµ­ì–´(ë²ˆì²´)</button>
                <button data-subaction="ta">íƒ€ë°€ì–´</button>
                <button data-subaction="th">íƒœêµ­ì–´</button>
                <button data-subaction="tr">í„°í‚¤ì–´</button>
                <button data-subaction="fa">í˜ë¥´ì‹œì•„ì–´</button>
                <button data-subaction="pt">í¬ë¥´íˆ¬ê°ˆì–´</button>
                <button data-subaction="pl">í´ë€ë“œì–´</button>
                <button data-subaction="fr">í”„ë‘ìŠ¤ì–´</button>
                <button data-subaction="ko">í•œêµ­ì–´</button>
                <button data-subaction="hi">íŒë””ì–´</button>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/quill-blot-formatter@1.0.5/dist/quill-blot-formatter.min.js"></script>

        <script>
            // í”ŒëŸ¬ê·¸ì¸ ë“±ë¡
            if (window.QuillBlotFormatter) {
                Quill.register(
                    'modules/blotFormatter',
                    window.QuillBlotFormatter.default ||
                        window.QuillBlotFormatter
                );
            }
        </script>

        <!-- Preloader -->
        <div id="preloader"></div>

        <!-- Vendor JS Files -->
        <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/vendor/php-email-form/validate.js"></script>
        <script src="assets/vendor/aos/aos.js"></script>
        <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
        <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
        <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
        <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

        <script src="assets/js/main.js"></script>
        <script src="assets/js/script.js?v=20251003"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

        <script>
            (function () {
                (function setupErrorLogger() {
                    const tag = (t) => `%c${t}`;
                    const style = 'color:#e11d48;font-weight:600';
                    window.addEventListener('error', (e) => {
                        console.log(
                            tag('[JS error]'),
                            style,
                            e.message,
                            e.filename,
                            e.lineno,
                            e.colno
                        );
                    });
                    window.addEventListener('unhandledrejection', (e) => {
                        console.log(
                            tag('[Promise rejection]'),
                            style,
                            e.reason
                        );
                    });
                })();

                window.SCTPL = window.SCTPL || {};
                window.registerTemplates =
                    window.registerTemplates ||
                    function (T) {
                        if (T && typeof T === 'object')
                            Object.assign(window.SCTPL, T);
                    };
                try {
                    if (typeof TPL === 'object' && TPL)
                        Object.assign(window.SCTPL, TPL);
                } catch (e) {
                    console.error('[tpl publish]', e);
                }
                window.SCTPL.prompt ??= {
                    title: 'AI í”„ë¡¬í”„íŠ¸',
                    body: '<div style="padding:8px 0">ë¡œë”©â€¦</div>',
                    foot: '',
                };

                /* ìœ í‹¸ */
                function titleFrom(btn) {
                    return (
                        btn?.dataset.title ||
                        btn?.getAttribute?.('aria-label') ||
                        btn?.querySelector?.('.sc-tip')?.textContent ||
                        'AI Panel'
                    ).trim();
                }
                const getTpl = (key) =>
                    (window.SCTPL && window.SCTPL[key]) || null;

                /*  íŒ¨ë„ DOM ë³´ì¥ */
                function ensureInlineDrawer() {
                    let drawer = document.getElementById('scDrawer');
                    let backdrop = document.getElementById('scDrawerBackdrop');
                    const wrap = document.querySelector('.wrap');
                    if (!drawer) {
                        backdrop = document.createElement('div');
                        backdrop.id = 'scDrawerBackdrop';
                        backdrop.className = 'sc-drawer__backdrop';
                        backdrop.hidden = true;

                        drawer = document.createElement('aside');
                        drawer.id = 'scDrawer';
                        drawer.className = 'sc-drawer';
                        drawer.setAttribute('aria-hidden', 'true');
                        drawer.innerHTML = `
        <div class="sc-drawer__head">
          <div id="scDrawerTitle" class="sc-drawer__title">AI Panel</div>
          <button id="scDrawerClose" class="sc-drawer__close" aria-label="close">âœ•</button>
        </div>
        <div id="scDrawerBody" class="sc-drawer__body"></div>
        <div id="scDrawerFoot" class="sc-drawer__foot"></div>
      `;
                        (wrap || document.body).append(backdrop, drawer);
                    }
                    return drawer;
                }
                function closeDrawer() {
                    const wrap = document.querySelector('.wrap');
                    const drawer = document.getElementById('scDrawer');
                    drawer?.classList.remove('open');
                    drawer?.setAttribute('aria-hidden', 'true');
                    wrap?.classList.remove('with-panel');
                }

                function openSimple(key = 'summary', btn) {
                    const drawer = ensureInlineDrawer();
                    const wrap = document.querySelector('.wrap');
                    const titleEl = document.getElementById('scDrawerTitle');
                    const body = document.getElementById('scDrawerBody');
                    const foot = document.getElementById('scDrawerFoot');

                    if (titleEl)
                        titleEl.textContent = titleFrom(btn) || 'AI Panel';
                    drawer.dataset.key = key || 'summary';
                    drawer.classList.add('open');
                    drawer.setAttribute('aria-hidden', 'false');
                    wrap?.classList.add('with-panel');

                    const tpl = getTpl(key);
                    if (body) {
                        body.innerHTML =
                            tpl?.body ||
                            `
        <div style="padding:10px 0; color:#6b7280; line-height:1.6">
          <p><b>${
              titleFrom(btn) || 'AI Panel'
          }</b> íŒ¨ë„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.</p>
          <p>ë§Œì•½ ê³„ì† ì´ ìƒíƒœë©´ <code>assets/js/script.js</code> ì´ˆê¸°í™” ì—ëŸ¬ì¼ ìˆ˜ ìˆì–´ìš”.</p>
        </div>
      `;
                    }
                    if (foot) foot.innerHTML = tpl?.foot || '';
                }
                window.DEBUG_OPEN_DRAWER_FALLBACK = openSimple;

                if (typeof window.DEBUG_OPEN_DRAWER !== 'function') {
                    window.DEBUG_OPEN_DRAWER =
                        window.DEBUG_OPEN_DRAWER_FALLBACK;
                }

                function openBridge(key = 'summary', btn) {
                    const main = window.DEBUG_OPEN_DRAWER;
                    if (
                        typeof main === 'function' &&
                        main !== window.DEBUG_OPEN_DRAWER_FALLBACK
                    ) {
                        return main(key, btn);
                    }
                    return window.DEBUG_OPEN_DRAWER_FALLBACK(key, btn);
                }

                (function bindDock() {
                    const dockById = document.getElementById('scDock');
                    const dockByClass = document.querySelector('.sc-dock');

                    function onDockClick(e) {
                        const btn = e.target.closest?.('.sc-dock__btn');
                        if (!btn) return;
                        const key = btn.dataset.action || 'prompt';
                        openBridge(key, btn);
                    }
                    dockById?.addEventListener('click', onDockClick);
                    dockByClass?.addEventListener('click', onDockClick);

                    document.addEventListener('click', (e) => {
                        const btn = e.target.closest?.('.sc-dock__btn');
                        if (!btn) return;
                        onDockClick(e);
                    });
                })();

                document.addEventListener('click', (e) => {
                    if (
                        !e.target.closest?.('#scDrawerClose') &&
                        e.target.id !== 'scDrawerBackdrop'
                    )
                        return;
                    closeDrawer();
                });
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') closeDrawer();
                });
            })();
        </script>
    </body>
</html>
